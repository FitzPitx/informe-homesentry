<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <p class="fs-4">Ventas Comparativo Año Anterior</p>
    <form [formGroup]="filterForm" (ngSubmit)="onSubmit()" class="btn-toolbar mb-2 mb-md-0">

        <!-- Selector de Sucursal -->
        <div class="input-group me-2">
            <span class="input-group-text">
                <i class="bi bi-building"></i>
            </span>
            <select class="form-select form-select-sm" formControlName="sucursal">
                <option value="" disabled>Sucursal</option>
                <option value="1">001 - Home Sentry Norte</option>
                <option value="21">021 - Home Sentry Plaza Americas</option>
                <option value="32">032 - Home Sentry Titan</option>
                <option value="53">053 - Home Sentry 116</option>
                <option value="68">068 - Home Sentry Salitre</option>
                <option value="84">084 - Sentry Cacique</option>
                <option value="100">100 - Home Sentry Villavicencio</option>
                <option value="140">140 - Sentry Cali 6ta Avenida</option>
                <option value="160">160 - Sentry Mayorca</option>
                <option value="180">180 - Sentry Fontanar Chia</option>
                <option value="200">200 - Sentry Viva Barranquilla</option>
                <option value="220">220 - Sentry Online</option>
                <option value="240">240 - Sentry Mercado Libre</option>
                <option value="280">280 - Hs Cartagena Bocagrande Plaza</option>
                <option value="300">300 - Sentry Medellin Santafe</option>
                <option value="320">320 - Sentry Plaza Central Bogota</option>
            </select>
        </div>

        <!-- Selector de Año -->
        <div class="input-group me-2">
            <span class="input-group-text">
                <i class="bi bi-calendar3"></i>
            </span>
            <select class="form-select form-select-sm" formControlName="year">
                <option value="" disabled selected>Año</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
            </select>
        </div>

        <!-- Botón de Aplicar Filtros -->
        <button type="submit" class="btn btn-sm btn-outline-primary d-flex align-items-center gap-1">
            <i class="bi bi-funnel"></i>
            Aplicar Filtros
        </button>
    </form>
</div>

<!-- <div class="container d-flex ">
    <div class="modern-input">
        <mat-form-field appearance="outline">
          <mat-label>Búsqueda</mat-label>
          <input matInput 
                 placeholder="Buscar..." 
                 [(ngModel)]="searchText" 
                 (keyup)="onInputChange()">
                 <mat-icon matPrefix><i class="bi bi-search ms-1"></i></mat-icon> 
        </mat-form-field>
      </div>
</div> -->


<div class="table-responsive">
    <!-- Template -->
    <table mat-table [dataSource]="listaVentasDataSource" class="mat-elevation-z8">

        <!-- Base columns -->
        <ng-container matColumnDef="codigoCategoria" sticky>
            <th mat-header-cell *matHeaderCellDef [attr.rowspan]="2" class="border-end border-bottom text-center">Código</th>
            <td class="border-0 border-end" mat-cell *matCellDef="let element">{{element.codigoCategoria}}</td>
            <td class="fw-bold" mat-footer-cell *matFooterCellDef>Totales</td>
        </ng-container>

        <ng-container matColumnDef="nombreCategoria" sticky>
            <th class="border-bottom text-center" mat-header-cell *matHeaderCellDef [attr.rowspan]="2">Nombre</th>
            <td class="border-0 border-bottom"mat-cell *matCellDef="let element">{{element.nombreCategoria}}</td>
            <td mat-footer-cell *matFooterCellDef></td>
        </ng-container>

        <ng-container *ngFor="let month of months">
            <ng-container *ngFor="let metric of metricsColumns" [matColumnDef]="month + '-' + metric">
              <th mat-header-cell *matHeaderCellDef>{{formatMetricName(metric)}}</th>
              <td mat-cell *matCellDef="let element" class="text-end" [ngClass]="{
                'cell-positive': element[month + '-' + metric] > 0,
                'cell-negative': element[month + '-' + metric] < 0
              }">
                <ng-container [ngSwitch]="metric">
                  <ng-container *ngSwitchCase="'margenActual'">
                    {{element[month + '-' + metric] | number:'1.0-0'}}%
                  </ng-container>
                  <ng-container *ngSwitchCase="'margenAnterior'">
                    {{element[month + '-' + metric] | number:'1.0-0'}}%
                  </ng-container>
                  <ng-container *ngSwitchDefault>
                    {{element[month + '-' + metric] | currency:'USD':'symbol':'1.0-0'}}
                  </ng-container>
                </ng-container>
              </td>
              <td mat-footer-cell *matFooterCellDef class="text-end">
                <ng-container *ngIf="!metricsToExcludeFromTotals.includes(metric)">
                  {{getTotalsByColumn()[month + '-' + metric] | currency:'USD':'symbol':'1.0-0'}}
                </ng-container>
              </td>
            </ng-container>
          </ng-container>

        <!-- Header columns with spaces-->
        <ng-container matColumnDef="first-group-spaces">
            <th mat-header-cell *matHeaderCellDef class="border border-0">&nbsp;</th>
        </ng-container>

        <ng-container matColumnDef="second-group-spaces" >
            <th mat-header-cell *matHeaderCellDef class="border border-0">&nbsp;</th>
        </ng-container>

        <!-- Month header columns -->
        <ng-container *ngFor="let month of months" [matColumnDef]="'header_' + month">
            <th mat-header-cell *matHeaderCellDef [attr.colspan]="9" class="border border-0 border-start border-bottom">
                {{month}}
            </th>
        </ng-container>

        <!-- Header rows -->
        <tr mat-header-row *matHeaderRowDef="getAllHeaderColumns()"></tr>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
    </table>
    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons aria-label="Selecciona una página">
    </mat-paginator>
</div>

<br><br><br>

<app-categoria-ventas></app-categoria-ventas>